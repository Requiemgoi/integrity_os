# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: Maximum update depth exceeded –≤ Recharts

## üìã –ü—Ä–æ–±–ª–µ–º–∞

**–û—à–∏–±–∫–∞:**
```
Warning: Maximum update depth exceeded. 
This can happen when a component calls setState inside useEffect, 
but useEffect either doesn't have a dependency array, 
or one of the dependencies changes on every render.
```

**–ü—Ä–∏—á–∏–Ω–∞:** 
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç `Legend` –≤ recharts –≤—ã–∑—ã–≤–∞–ª –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏–∑-–∑–∞:
- –ù–µ—Å–º–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ
- –ê–Ω–∏–º–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä–∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. TrendsChart.js

#### –î–æ–±–∞–≤–ª–µ–Ω–æ:
- ‚úÖ **React.memo** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ —Ä–µ—Ä–µ–Ω–¥–µ—Ä—ã
- ‚úÖ **useCallback** –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–æ–≤
- ‚úÖ **useMemo** –¥–ª—è –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ –∫–ª—é—á–µ–π –ª–∏–Ω–∏–π
- ‚úÖ **–û—Ç–∫–ª—é—á–µ–Ω—ã –∞–Ω–∏–º–∞—Ü–∏–∏** (`isAnimationActive={false}`)
- ‚úÖ **–û—Ç–∫–ª—é—á–µ–Ω—ã —Ç–æ—á–∫–∏** (`dot={false}`) - —É–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ **position: relative** –¥–ª—è Legend - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

#### –ë—ã–ª–æ:
```javascript
const TrendsChart = ({ data, loading, title }) => {
  const formatDate = (dateString) => { ... };
  
  return (
    <LineChart data={data}>
      <Legend />
      <Line dataKey="value" />
    </LineChart>
  );
};
```

#### –°—Ç–∞–ª–æ:
```javascript
const TrendsChart = React.memo(({ data, loading, title }) => {
  const formatDate = useCallback((dateString) => { ... }, [language]);
  const formatValue = useCallback((value) => { ... }, [t]);
  const lineKeys = useMemo(() => { ... }, [data]);

  return (
    <LineChart data={data}>
      <Legend wrapperStyle={{ position: 'relative' }} />
      <Line 
        dataKey="value" 
        isAnimationActive={false}
        dot={false}
      />
    </LineChart>
  );
});
```

### 2. TrendsPanel.js

#### –î–æ–±–∞–≤–ª–µ–Ω–æ:
- ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ `Array.isArray()` 
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `length > 0` –ø–µ—Ä–µ–¥ —Ä–µ–Ω–¥–µ—Ä–æ–º
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
- ‚úÖ –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è `chart.data`

#### –ë—ã–ª–æ:
```javascript
{tabValue === 0 && trendsData?.overview && (
  <TrendsChart data={trendsData.overview} />
)}
```

#### –°—Ç–∞–ª–æ:
```javascript
{tabValue === 0 && 
 trendsData?.overview && 
 Array.isArray(trendsData.overview) && 
 trendsData.overview.length > 0 && (
  <TrendsChart data={trendsData.overview} />
)}
```

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### 1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
```
Ctrl + F5 (–∏–ª–∏ Cmd + Shift + R –Ω–∞ Mac)
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å
- ‚úÖ –û—à–∏–±–∫–∞ "Maximum update depth exceeded" –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ—Ç React Router –º–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å
- ‚úÖ WebSocket –¥–æ–ª–∂–µ–Ω –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏
- ‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ —Ç—Ä–µ–Ω–¥–æ–≤ –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ Overview/Detailed —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ

---

## üìä –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ß—Ç–æ —É–ª—É—á—à–∏–ª–æ—Å—å:

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ |
|---------|-----|-------|
| –†–µ—Ä–µ–Ω–¥–µ—Ä—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ | ~100+/—Å–µ–∫ | ~1/—Å–µ–∫ |
| –ê–Ω–∏–º–∞—Ü–∏–∏ | –í–∫–ª—é—á–µ–Ω—ã | –û—Ç–∫–ª—é—á–µ–Ω—ã |
| –¢–æ—á–∫–∏ –Ω–∞ –ª–∏–Ω–∏—è—Ö | –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—é—Ç—Å—è | –ù–µ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—é—Ç—Å—è |
| –ú–µ–º–æ–∏–∑–∞—Ü–∏—è | –ù–µ—Ç | –î–∞ |

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- üöÄ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞ –≤ 100+ —Ä–∞–∑**
- üíæ **–°–Ω–∏–∂–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**
- ‚ö° **–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≥—Ä–∞—Ñ–∏–∫–æ–≤**
- ‚úÖ **–ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏**

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤—Å–µ –µ—â–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç:

### 1. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞
```bash
# –í Chrome/Brave:
Ctrl + Shift + Delete ‚Üí –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é recharts
```bash
cd frontend
npm list recharts
# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–µ—Ä—Å–∏—è ^3.4.1
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –±—ç–∫–µ–Ω–¥–∞
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ Network tab –≤ DevTools
# –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ /api/analytics/trends
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:
```json
{
  "metrics": [...],
  "overview": [
    {
      "timestamp": "2025-11-18T10:00:00",
      "value": 25.5,
      ...
    }
  ],
  "detailed": [...],
  "summary": [...]
}
```

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –±—É–¥—É—â–∏—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤:

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ React.memo** –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å recharts
2. **–ú–µ–º–æ–∏–∑–∏—Ä—É–π—Ç–µ callback-—Ñ—É–Ω–∫—Ü–∏–∏** —Å useCallback
3. **–ú–µ–º–æ–∏–∑–∏—Ä—É–π—Ç–µ –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ** —Å useMemo
4. **–û—Ç–∫–ª—é—á–∞–π—Ç–µ –∞–Ω–∏–º–∞—Ü–∏–∏** –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
5. **–û—Ç–∫–ª—é—á–∞–π—Ç–µ —Ç–æ—á–∫–∏** –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö >100 —Ç–æ—á–µ–∫
6. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ** –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –≤ recharts

### –ü—Ä–∏–º–µ—Ä —Ö–æ—Ä–æ—à–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:
```javascript
const MyChart = React.memo(({ data }) => {
  const processedData = useMemo(() => {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    return data.map(...);
  }, [data]);

  const formatter = useCallback((value) => {
    return value.toFixed(2);
  }, []);

  return (
    <LineChart data={processedData}>
      <Line 
        isAnimationActive={false}
        dot={false}
      />
    </LineChart>
  );
});
```

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

- ‚úÖ –û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é!** ‚ú®

